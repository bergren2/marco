## Local Development
#### Contents
- [Setup](#setup)
- [VSCode Configuration](#vscode-configuration)
  - [File Explorer](#file-explorer)
  - [Debugging](#debugging)
  - [Extensions](#extensions)

## Setup
[NodeJS](https://nodejs.org/) is required. It can be installed [here](https://nodejs.org/en/download/).

This project uses [yarn](https://yarnpkg.com) in place of npm. Follow [these instructions](https://yarnpkg.com/en/docs/install) to install yarn globally.

> Warning: Windows users should not install [yarn](https://yarnpkg.com) via NPM, instead use the [downloadable](https://yarnpkg.com/latest.msi) MSI executable.

Once installed, yarn is used to install all dependencies.
```bash
yarn install
```

#### Running Locally
```bash
yarn build
yarn start <command>
```

#### Testing
Tests can be run with
```bash
yarn test
```

Additionally, code coverage can be printed at the end of test execution by running
```bash
yarn test:coverage
```

## VSCode Configuration
#### File Explorer
To ignore folders generated by the `test:coverage` script, add this to `.vscode/settings.json`:
```json
"files.exclude": {
    ".nyc_output/": true,
    "coverage/": true
}
```

#### Debugging
Debugging for the main program and unit tests can be accomplished with the following launch.json:
```json
{
    // Use IntelliSense to learn about possible attributes.
    // Hover to view descriptions of existing attributes.
    // For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387
    "version": "0.2.0",
    "configurations": [
        {
            "type": "node",
            "request": "launch",
            "name": "Launch Program",
            "program": "${workspaceFolder}/bin/marco",
            "sourceMapPathOverrides": {
                "webpack://marco/./~/*": "${workspaceRoot}/node_modules/*",
                "webpack://marco/./*": "${workspaceRoot}/*",
                "webpack://marco/*": "*"
            },
            "smartStep": true,
            "cwd": "${workspaceFolder}",
            "sourceMaps": true,
            "showAsyncStacks": true,
            "outputCapture": "std",
            "console": "externalTerminal",
            "args": [
                "list"
            ]
        },
        {
            "type": "node",
            "request": "launch",
            "name": "Launch Tests",
            "program": "${workspaceFolder}/node_modules/mocha/bin/_mocha",
            "sourceMapPathOverrides": {
                "webpack://marco/./~/*": "${workspaceRoot}/node_modules/*",
                "webpack://marco/./*": "${workspaceRoot}/*",
                "webpack://marco/*": "*"
            },
            "smartStep": true,
            "cwd": "${workspaceFolder}",
            "sourceMaps": true,
            "showAsyncStacks": true,
            "outputCapture": "std",
            "args": [
                "-r",
                "ts-node/register",
                "-r",
                "reflect-metadata",
                "--no-timeouts",
                "--colors",
                "spec/**/*.spec.ts"
            ]
        }
    ]
}
```
The given marco command can be changed by changing the `"args"` value in the first configuration.

#### Extensions
If using [Mocha Sidebar](https://marketplace.visualstudio.com/items?itemName=maty.vscode-mocha-sidebar) for VSCode, add this to `.vscode/settings.json`:
```json
"mocha.files.glob": "spec/**/*.ts",
"mocha.requires": [
    "ts-node/register",
    "reflect-metadata",
    "spec/support/setup.ts"
]
```
